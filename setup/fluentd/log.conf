<source>
  @type forward
</source>

<match *>
  @type copy

  <store>
    @type file
    path /var/log/fluent/${container_name}/log_%Y%m%d_%H%M
    append true

    <buffer time, container_name>
      @type file
      path /var/log/fluent/buffer/
      timekey      10m
      timekey_wait 1m
      flush_at_shutdown true
    </buffer>

    <format>
      @type json
    </format>
  </store>

  <store>
    @type elasticsearch
    hosts opensearch-node1,opensearch-node2
    port 9200
    scheme https
    user admin
    password admin
    ssl_verify false
    verify_es_version_at_startup false
    default_elasticsearch_version 7
    logstash_format true
  </store>
</match>
